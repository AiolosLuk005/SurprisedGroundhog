<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>Surprised Groundhog Â· V1.01</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/style.css">

  <style>
    /* ç›®å½•é€‰æ‹©å¼¹çª— */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.28);display:none;z-index:9999}
    .modal-content{width:760px;max-width:92vw;margin:10vh auto;background:#fff;border-radius:10px;
      box-shadow:0 16px 48px rgba(0,0,0,.18);padding:10px 12px}
    .modal-head,.modal-foot{display:flex;align-items:center;justify-content:space-between;padding:6px 4px}
    .modal-body{max-height:64vh;overflow:auto;padding:6px 2px}
    #dirList{list-style:none;margin:0;padding:0}
    #dirList li{padding:8px 10px;border-bottom:1px solid #f0f0f0;cursor:pointer}
    #dirList li:hover{background:#f7f7f7}
  </style>

  <style>
  /* å…¨å±åŠ è½½é®ç½© */
  .loader { position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
    background: rgba(255,255,255,.65); z-index: 99999; text-align: center; }
  .loader.show { display: flex; }
  .spinner{ width: 44px; height: 44px; border: 4px solid #e5e7eb; border-top-color: #111827;
    border-radius: 50%; animation: spin .9s linear infinite; margin: 12px auto; }
  @keyframes spin{ to{ transform: rotate(360deg); } }
  .spinner.hourglass{ width: 24px; height: 24px; border:0; position:relative; }
  .spinner.hourglass:before, .spinner.hourglass:after{
    content:""; position:absolute; left:0; right:0; margin:auto; width:0; height:0;
    border-left:12px solid transparent; border-right:12px solid transparent; animation: flip 1.2s infinite;
  }
  .spinner.hourglass:before{ top:0; border-bottom:14px solid #111827; }
  .spinner.hourglass:after{ bottom:0; border-top:14px solid #111827; animation-delay:.6s; }
  @keyframes flip{ 0%,100%{ transform: scaleY(1);} 50%{ transform: scaleY(0.2);} }
  .loading-text { font-size: 12px; color:#444; }

  /* ç¡®è®¤ / é¢„è§ˆå¼¹çª— */
  .confirm-modal, .preview-modal { position: fixed; inset: 0; background: rgba(0,0,0,.5);
    display: none; z-index: 10000; align-items: center; justify-content: center; }
  .confirm-modal-content, .preview-modal-content {
    background: #fff; padding: 20px; border-radius: 8px; max-width: 680px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2); text-align: left;
  }
  .preview-content { max-width: 100%; max-height: 80vh; overflow: auto; }
  .preview-content img, .preview-content video { max-width: 100%; height: auto; }
  </style>
</head>

<body data-user="{{ current_user or '' }}">
  <div class="topbar">
    <h2 class="brand">Surprised Groundhog Â· V1.01</h2>
    <img class="logo" src="/static/logo.png" alt="logo">
    <!-- ç”¨æˆ·å·¥å…·æŒ‚è½½åŒºï¼šè®¾ç½® / ç™»å½• / ç™»å‡º / ç”¨æˆ·å -->
    <div id="userTools" style="margin-left:auto; display:flex; align-items:center; gap:8px;"></div>
  </div>

  <!-- é¡¶éƒ¨æœç´¢å·¥å…·æ  -->
  <div class="toolbar" id="searchToolbar">
    <input id="searchInput" type="text" placeholder="å†…å®¹æœç´¢â€¦" style="min-width:220px;">
    <label style="margin-left:8px;">kï¼š</label>
    <input id="searchK" type="number" value="5" min="1" max="100" style="width:60px;">
    <label class="pill"><input type="checkbox" id="chkVector" checked> å‘é‡</label>
    <label class="pill"><input type="checkbox" id="chkFull" checked> å…¨æ–‡</label>
    <label class="pill"><input type="checkbox" id="chkRegex"> æ­£åˆ™</label>
    <button class="btn" id="filterBuilderBtn">è¿‡æ»¤å™¨æ„é€ å™¨</button>
    <button class="btn" id="searchBtn">æœç´¢</button>
  </div>

  <div class="row">
    <label for="category">æ¡£æ¡ˆç§ç±»ï¼š</label>
    <select id="category">
      <option value="TEXT">æ–‡å­—æ¡£æ¡ˆ</option>
      <option value="DATA">æ•°æ®æ¡£æ¡ˆ</option>
      <option value="SLIDES">ç®€æŠ¥æ¡£æ¡ˆ</option>
      <option value="PDF">PDF æ¡£æ¡ˆ</option>
      <option value="ARCHIVE">å‹ç¼©æ¡£æ¡ˆ</option>
      <option value="IMAGE">å›¾ç‰‡æ¡£æ¡ˆ</option>
      <option value="VIDEO">è§†é¢‘æ¡£æ¡ˆ</option>
      <option value="AUDIO">éŸ³é¢‘æ¡£æ¡ˆ</option>
    </select>

    <label for="types">æ¡£æ¡ˆç±»å‹ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</label>
    <select id="types" multiple size="6" style="min-width: 160px;"></select>

    <label for="dir">æ‰«æç›®å½•ï¼š</label>
    <input id="dir" type="text" value="{{ default_dir }}" placeholder="è¯·é€‰æ‹©è¦æ‰«æçš„ç›®å½•â€¦" style="min-width: 300px;">
    <button class="btn" id="pickDir">é€‰æ‹©ç›®å½•</button>

    <label class="pill"><input id="hash" type="checkbox" {% if enable_hash_default %}checked{% endif %}> è®¡ç®— SHA256</label>
    <label class="pill"><input id="recur" type="checkbox" checked> åŒ…å«å­æ–‡ä»¶å¤¹</label>

    <label>åˆ†é¡µï¼š</label>
    <input id="page_size" type="number" value="{{ page_size_default }}" min="10" max="10000">
    <button class="btn" id="scanBtn">å¼€å§‹æ‰«æ</button>
    <span id="count" class="muted right">æœªæ‰«æ</span>
  </div>

  <div class="toolbar">
    <input id="q" type="text" placeholder="æœç´¢ï¼ˆæ–‡ä»¶å/æ‰©å±•å/è·¯å¾„ï¼‰" style="min-width:280px;">
    <input id="kwFilter" type="text" placeholder="æŒ‰å…³é”®è¯åˆ—è¿‡æ»¤ï¼ˆç©ºæ ¼åˆ†éš”å¤šä¸ªï¼‰" style="min-width:240px;">
    <button class="btn" id="kwFilterBtn">è¿‡æ»¤</button>
    <select id="kwStrategy" title="å…³é”®è¯æå–ç­–ç•¥" style="min-width:140px;">
      <option value="hybrid" selected>hybridï¼ˆé»˜è®¤ï¼‰</option>
      <option value="fast">fastï¼ˆå¿«é€Ÿï¼‰</option>
      <option value="embed">embedï¼ˆè¯­ä¹‰é‡æ’ï¼‰</option>
      <option value="llm">llmï¼ˆæ¨¡å‹ç›´ç”Ÿï¼‰</option>
    </select>
    <label style="margin-left:8px;">å…³é”®è¯é•¿åº¦ï¼š</label>
    <input id="kw_len" type="number" value="50" min="10" max="200" style="width:80px;">
    <button class="btn" id="exportBtn">å¯¼å‡º CSV</button>
    <button class="btn" id="importBtn">å¯¼å…¥ MySQL</button>
  </div>

  <div class="toolbar">
    <!-- ç”Ÿæˆå‰ç¼€ -->
    <input id="kwSeeds" type="text" placeholder="ç”Ÿæˆå‰ç¼€ï¼ˆåˆ†å·;åˆ†éš”ï¼‰" style="min-width:220px;">
    <label class="pill" title="ä»…å¯¹å…³é”®è¯ä¸ºç©ºçš„è¡Œæ‰§è¡Œç”Ÿæˆï¼Œå·²å­˜åœ¨çš„ä¸è¦†ç›–">
      <input id="kwOnlyEmpty" type="checkbox"> ä»…ä¸ºç©ºç”Ÿæˆ
    </label>

    <button class="btn" id="genKwBtn">æå–å…³é”®è¯</button>
    <button class="btn" id="aiRefineBtn" title="åœ¨ hybrid æ¨¡å¼ä¸‹è§¦å‘ LLM ç²¾ä¿®ï¼ˆforce_llm=trueï¼‰">AI ä¼˜åŒ–</button>
    <button class="btn" id="clearKwBtn">æ¸…é™¤å…³é”®è¯</button>
    <button class="btn" id="applyMoveBtn">æ‰¹é‡ç§»åŠ¨</button>
    <button class="btn" id="applyRenameBtn">æ‰¹é‡é‡å‘½å</button>
    <button class="btn" id="applyDeleteBtn">æ‰¹é‡åˆ é™¤</button>
  </div>

  <table id="tbl" class="fixed-table">
    <colgroup>
      <col class="col-select">
      <col class="col-name">
      <col class="col-path">
      <col class="col-ext">
      <col class="col-category">
      <col class="col-size">
      <col class="col-mtime">
      <col class="col-keywords">
      <col class="col-move">
      <col class="col-rename">
      <col class="col-preview">
    </colgroup>
    <thead>
      <tr>
        <th>é€‰</th>
        <th>æ–‡ä»¶å</th>
        <th>å®Œæ•´è·¯å¾„</th>
        <th>æ‰©å±•å</th>
        <th>ç±»åˆ«</th>
        <th>å¤§å°ï¼ˆkBï¼‰</th>
        <th>ä¿®æ”¹æ—¶é—´</th>
        <th>å…³é”®è¯</th>
        <th>ç§»åŠ¨ç›®æ ‡</th>
        <th>é‡å‘½åä¸º</th>
        <th>é¢„è§ˆ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="row">
    <button class="btn" id="prev">ä¸Šä¸€é¡µ</button>
    <span id="pageinfo" class="muted"></span>
    <button class="btn" id="next">ä¸‹ä¸€é¡µ</button>
  </div>

  <!-- æœç´¢ç»“æœåŒºåŸŸ -->
  <div id="searchResults" class="row" style="flex-direction:column; gap:8px;"></div>

  <!-- ç›®å½•é€‰æ‹©å¼¹çª— -->
  <div id="dirModal" class="modal">
    <div class="modal-content">
      <div class="modal-head">
        <strong>é€‰æ‹©ç›®å½•</strong>
        <button class="btn btn-sm" id="dirClose">å…³é—­</button>
      </div>
      <div class="modal-body">
        <div class="row" style="padding:0 0 10px 0;">
          <button class="btn btn-sm" id="dirUp">ä¸Šä¸€çº§</button>
          <span id="dirHere" class="small"></span>
        </div>
        <ul id="dirList"></ul>
      </div>
      <div class="modal-foot">
        <button class="btn" id="dirOk">ä½¿ç”¨æ­¤ç›®å½•</button>
      </div>
    </div>
  </div>

  <!-- è¿‡æ»¤å™¨æ„é€ å™¨å¼¹çª— -->
  <div id="filterModal" class="modal">
    <div class="modal-content">
      <div class="modal-head">
        <strong>è¿‡æ»¤å™¨æ„é€ å™¨</strong>
        <button class="btn btn-sm" id="filterClose">å…³é—­</button>
      </div>
      <div class="modal-body" style="display:flex;flex-direction:column;gap:8px;">
        <label>where JSONï¼š</label>
        <textarea id="whereInput" style="width:100%;height:60px;"></textarea>
        <label>where_document JSONï¼š</label>
        <textarea id="whereDocInput" style="width:100%;height:60px;"></textarea>
      </div>
      <div class="modal-foot">
        <div></div>
        <button class="btn" id="filterOk">ç¡®å®š</button>
      </div>
    </div>
  </div>

  <!-- ç¡®è®¤å¼¹çª— -->
  <div id="confirmModal" class="confirm-modal" style="display:none;">
    <div class="confirm-modal-content">
      <p id="confirmMessage"></p>
      <div style="margin-top: 20px; text-align:right;">
        <button class="btn" id="confirmCancel">å–æ¶ˆ</button>
        <button class="btn" id="confirmOk">ç¡®è®¤</button>
      </div>
    </div>
  </div>

  <!-- é¢„è§ˆå¼¹çª— -->
  <div id="previewModal" class="preview-modal" style="display:none;">
    <div class="preview-modal-content">
      <div class="modal-head">
        <strong id="previewTitle"></strong>
        <button class="btn btn-sm" id="previewClose">å…³é—­</button>
      </div>
      <div id="previewContent" class="preview-content"></div>
    </div>
  </div>

  <!-- è®¾ç½®å¼¹çª— -->
  <div id="settingsModal" class="confirm-modal" style="display:none;">
    <div class="confirm-modal-content" style="max-width:760px;">
      <div class="modal-head">
        <strong>âš™ï¸ ç³»ç»Ÿè®¾ç½®</strong>
        <button class="btn btn-sm" id="settingsCancel">å…³é—­</button>
      </div>
      <div class="modal-body">
        <fieldset style="margin-bottom:12px;">
          <legend>ç•Œé¢ä¸»é¢˜</legend>
          <label class="pill"><input type="radio" name="theme" value="light"> äº®è‰²è°ƒ</label>
          <label class="pill"><input type="radio" name="theme" value="dark"> æš—è‰²è°ƒ</label>
          <label class="pill"><input type="radio" name="theme" value="system" checked> è·Ÿéšç³»ç»Ÿ</label>
        </fieldset>

        <fieldset style="margin-bottom:12px;">
          <legend>AI è®¾ç½®</legend>
          <div class="row">
            <label style="min-width:90px;">æä¾›æ–¹ï¼š</label>
            <select id="aiProvider" style="min-width:160px;">
              <option value="ollama">Ollamaï¼ˆæœ¬åœ°ï¼‰</option>
              <option value="chatgpt">ChatGPTï¼ˆè¿œç¨‹ï¼‰</option>
              <option value="deepseek">DeepSeekï¼ˆè¿œç¨‹ï¼‰</option>
            </select>
          </div>
          <div class="row">
            <label style="min-width:90px;">æœåŠ¡URLï¼š</label>
            <input id="aiUrl" type="text" placeholder="http://localhost:11434" style="min-width:320px;">
          </div>
          <div class="row">
            <label style="min-width:90px;">API Keyï¼š</label>
            <input id="aiApiKey" type="password" placeholder="å¯ç•™ç©ºï¼ˆæœ¬åœ°Ollamaä¸éœ€è¦ï¼‰" style="min-width:320px;">
          </div>
          <div class="row">
            <label style="min-width:90px;">æ¨¡å‹ï¼š</label>
            <select id="aiModel" style="min-width:220px;">
              <option value="">ï¼ˆç¨ååŠ è½½/æˆ–æ‰‹åŠ¨å¡«å†™ï¼‰</option>
            </select>
          </div>
        </fieldset>

        <fieldset>
          <legend>åŠŸèƒ½æƒé™ï¼ˆç®¡ç†å‘˜å‹¾é€‰å¼€å…³ï¼‰</legend>
          <div class="row" style="flex-wrap:wrap; gap:10px;">
            <label class="pill"><input type="checkbox" id="feat_text" checked> æ–‡å­—</label>
            <label class="pill"><input type="checkbox" id="feat_data" checked> æ•°æ®</label>
            <label class="pill"><input type="checkbox" id="feat_slides" checked> ç®€æŠ¥</label>
            <label class="pill"><input type="checkbox" id="feat_pdf" checked> PDF</label>
            <label class="pill"><input type="checkbox" id="feat_archive" checked> å‹ç¼©</label>
            <label class="pill"><input type="checkbox" id="feat_image" checked> å›¾ç‰‡</label>
            <label class="pill"><input type="checkbox" id="feat_video" checked> è§†é¢‘</label>
            <label class="pill"><input type="checkbox" id="feat_audio" checked> éŸ³é¢‘</label>
            <label class="pill"><input type="checkbox" id="feat_ai_keywords" checked> AIå…³é”®è¯</label>
            <label class="pill"><input type="checkbox" id="feat_move" checked> ç§»åŠ¨</label>
            <label class="pill"><input type="checkbox" id="feat_rename" checked> é‡å‘½å</label>
            <label class="pill"><input type="checkbox" id="feat_delete" checked> åˆ é™¤</label>
            <label class="pill"><input type="checkbox" id="feat_image_caption"> åå‘æç¤ºè¯</label>
            <label class="pill"><input type="checkbox" id="feat_video_preview"> è§†é¢‘é¢„è§ˆ</label>
            <label class="pill"><input type="checkbox" id="feat_audio_preview"> éŸ³é¢‘é¢„è§ˆ</label>
          </div>
        </fieldset>
      </div>
      <div class="modal-foot">
        <div></div>
        <button class="btn" id="settingsSave">ä¿å­˜è®¾ç½®</button>
      </div>
    </div>
  </div>

  <!-- ç™»å½•å¼¹çª— -->
  <div id="loginModal" class="confirm-modal" style="display:none;">
    <div class="confirm-modal-content" style="max-width:420px;">
      <div class="modal-head">
        <strong>ğŸ” ç™»å½•</strong>
        <button class="btn btn-sm" id="loginCancel">å…³é—­</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <label style="min-width:80px;">è´¦å·ï¼š</label>
          <input id="loginUser" type="text" placeholder="admin" style="min-width:220px;">
        </div>
        <div class="row">
          <label style="min-width:80px;">å¯†ç ï¼š</label>
          <input id="loginPass" type="password" placeholder="admin" style="min-width:220px;">
        </div>
      </div>
      <div class="modal-foot">
        <div></div>
        <button class="btn" id="loginConfirm">ç™»å½•</button>
      </div>
    </div>
  </div>

  <!-- å…¨å±€åŠ è½½å±‚ -->
  <div id="loading" class="loader" aria-hidden="true">
    <div class="spinner hourglass"></div>
    <div class="loading-text">æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™â€¦</div>
  </div>

  <!-- å¸¦ç‰ˆæœ¬å·é¿å…ç¼“å­˜ -->
  <script src="/static/app_classic.js?v=20250821a"></script>
</body>
</html>
